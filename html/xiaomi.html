<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.3"/>
    <title>仿小米商城</title>
    <meta name="keywords" content=""/>
    <meta name="description" content="">
    <link rel="shortcut icon" href="//resource.lwrong.com/public/img/xiaomi/favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="//resource.lwrong.com/public/img/xiaomi/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/xiaomi.css">
</head>
<body>
    <div id="app">
        <div class="top">
            <div class="nav">
                <ul>
                    <li><a href="javascript:void(0)">小米官网</a></li>
                    <li><a href="javascript:void(0)">小米商城</a></li>
                    <li><a href="javascript:void(0)">小米澎湃OS</a></li>
                    <li><a href="javascript:void(0)">小米汽车</a></li>
                    <li><a href="javascript:void(0)">云服务</a></li>
                    <li><a href="javascript:void(0)">IoT</a></li>
                    <li><a href="javascript:void(0)">有品</a></li>
                    <li><a href="javascript:void(0)">小爱开放平台</a></li>
                    <li><a href="javascript:void(0)">资质证照</a></li>
                    <li><a href="javascript:void(0)">协议规则</a></li>
                    <li><a href="javascript:void(0)">下载app</a></li>
                    <li><a href="javascript:void(0)">Select Location</a></li>
                </ul>
                <ul>
                    <li><a href="javascript:void(0)">登录</a></li>
                    <li><a href="javascript:void(0)">注册</a></li>
                    <li><a href="javascript:void(0)">消息通知</a></li>
                    <li class="car">
                        <a href="javascript:void(0)">
                            <i class="iconfont i-car"></i>购物车（0）
                            <div class="car-list">购物车中还没有商品，赶紧选购吧！</div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="second clearfix">
            <div class="header">
                <a href="#" class="logo"><h1>关键词：小米</h1></a>
                <ul>
                    <li><a href="javascript:void(0)">Xiaomi手机</a></li>
                    <li><a href="javascript:void(0)">Redmi手机</a></li>
                    <li><a href="javascript:void(0)">电视</a></li>
                    <li><a href="javascript:void(0)">笔记本</a></li>
                    <li><a href="javascript:void(0)">平板</a></li>
                    <li><a href="javascript:void(0)">家电</a></li>
                    <li><a href="javascript:void(0)">路由器</a></li>
                    <li><a href="javascript:void(0)">服务中心</a></li>
                    <li><a href="javascript:void(0)">社区</a></li>
                    <li class="detail">
                        <div>
                            <a href="#">
                                <img src="" alt="">
                                <div>红米小米手机</div>
                                <div>1888元</div>
                            </a>
                            <a href="#">
                                <img src="" alt="">
                                <div>红米小米手机红米小米手机</div>
                                <div>1888元</div>
                            </a>
                            <a href="#">
                                <img src="" alt="">
                                <div></div>
                                <div>1888元</div>
                            </a>
                            <a href="#">
                                <img src="" alt="">
                                <div></div>
                                <div>1888元</div>
                            </a>
                            <a href="#">
                                <img src="" alt="">
                                <div></div>
                                <div>1888元</div>
                            </a>
                            <a href="#">
                                <img src="" alt="">
                                <div></div>
                                <div>1888元</div>
                            </a>
                        </div>
                    </li>
                    <li class="search">
                        <form action="#">
                            <label for="search"></label>
                            <input id="search" type="text" name="search" autocomplete="off" placeholder="手机">
                            <button onclick="return false;" class="iconfont i-search"></button>
                            <div class="tips">
                                <ul>
                                    <li>手机换新</li>
                                    <li>空调</li>
                                    <li>笔记本</li>
                                    <li>电视</li>
                                    <li>洗衣机</li>
                                </ul>
                            </div>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
        <div class="third">
            <div class="carousel">
                <a href="javascript:void(0)"><img class="carousel-img" src="" alt=""></a>
                <a href="javascript:void(0)" data-action="arrow(left)" class="iconfont i-arrow_left"></a>
                <a href="javascript:void(0)" data-action="arrow(right)" class="iconfont i-arrow_right"></a>
                <div class="dot-list">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot dot-selected">
                    </span><span class="dot"></span>
                </div>
            </div>
            <div class="menu">
                <ul>
                    <li>
                        <a class="menu-item" data-pick="mobile" href="javascript:void(0)">手机
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="tv" href="javascript:void(0)">电视
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="appliances" href="javascript:void(0)">家电
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="desktop" href="javascript:void(0)">笔记本 平板
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="outdoor" href="javascript:void(0)">出行 穿戴
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="player" href="javascript:void(0)">耳机 音响
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="health" href="javascript:void(0)">健康 儿童
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="life" href="javascript:void(0)">生活 箱包
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="wifi" href="javascript:void(0)">智能 路由器
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page"></div>
                    </li>
                    <li>
                        <a class="menu-item" data-pick="power" href="javascript:void(0)">电源 配件
                            <i class="iconfont i-arrow_right"></i>
                        </a>
                        <div class="menu-item-page">
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div id="menu-box" style="display: none" class="box">
        <img src="" alt="">
        <span></span>
    </div>
</body>
<script>
    const detail_img_list = ["https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/b4846501f1e9be04d6d2e859deb0d80e.png?thumb=1&w=160&h=110&f=webp&q=90"];
    let detailImgElems = document.querySelectorAll(".header .detail a img");
    detailImgElems.forEach(img => {
        img.src = detail_img_list[0];//only one url in list
    })
    //加载图片
    const carousel_img_list = ["https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/01a422c2d04a7668e6d1d4748aeadf61.jpg?thumb=1&w=1226&h=460&f=webp&q=90"];
    let carouselImgElem = document.querySelector(".carousel .carousel-img");
    carouselImgElem.src = carousel_img_list[0];//only one url in list
    //监听轮播点击事件
    let dotListElem = document.querySelector(".carousel .dot-list");
    const dotSelected = "dot-selected";
    dotListElem.addEventListener("click", e => {
        if (!e.target.classList.contains(dotSelected)) {
            document.querySelectorAll(".carousel .dot-list .dot").forEach(dotElem => dotElem.classList.remove(dotSelected));
            e.target.classList.add(dotSelected);
        }
    });

    //监听菜单hover
    let menuMap = new Map();
    const boxSrcList = [{
        name: "小米智能电视",
        src: "https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/c2e3fdbf6fe7a13c06644f16c8dc8877.png?thumb=1&w=40&h=40&f=webp&q=90"
    }];
    const pageWidthVarName = "--pageWidth";
    const oneColWidth = 248;
    const menuBox_to_clone = document.getElementById("menu-box");
    menuBox_to_clone.removeAttribute("id");
    document.querySelector(".menu").addEventListener("mouseover", e => {

        let pick;
        let menu_item_page;
        if (e.target.classList.contains("menu-item")) {
            menu_item_page = e.target.parentNode.querySelector(".menu-item-page");
            pick = e.target.dataset.pick;
        } else if (e.target.parentNode.classList.contains("menu-item")) {//点到菜单里的图标了
            menu_item_page = e.target.parentNode.parentNode.querySelector(".menu-item-page");
            pick = e.target.parentNode.dataset.pick;
        } else {
            //点到右边展示页面去了
            return;
        }
        if (menuMap.get(pick)) {
            return;//已经有过了，节流
        }
        let size = 13;//boxSrcList.length;
        // console.log(getComputedStyle(menu_item_page).getPropertyValue(pageWidthVarName));
        menu_item_page.style.setProperty(pageWidthVarName, (Math.floor((size - 1) / 6) + 1) * oneColWidth + "px");
        menu_item_page.innerHTML = "";//delete all node
        for (let i = 0; i < size; i++) {
            let appendChild = menu_item_page.appendChild(menuBox_to_clone.cloneNode(true));
            appendChild.style.display = "";
            appendChild.querySelector("img").src = boxSrcList[0].src;
            appendChild.querySelector("span").textContent = boxSrcList[0].name;
        }
        menuMap.set(pick, size);
        setTimeout(() => menuMap.delete(pick), 1000 * 60);//节流
    });
</script>
</html>